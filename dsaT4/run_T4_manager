#!/bin/bash
conda activate casa310nsfrb
echo "realtime candcutter active"
completeness="false"
rt="true"
if [ "$completeness" = "true" ];
then
	taskset --cpu-list 21 python T4_manager.py --subimgpix 51 --SNRthresh 6 --useTOA --psfpercentile 70 --cluster --avgcluster --psfcluster --clusteriters 2 --maxProcesses 5 --completeness --searchradius 0.25  #--daskaddress "tcp://10.42.0.228:8786" "$@" #--cluster --psfcluster --classify3D
else
	if [ "$rt" = "true" ];
	then
		taskset --cpu-list 21 python T4_manager.py --subimgpix 50 --gridsize 175 --SNRthresh 6 --useTOA --psfpercentile 70 --maxcands 10 --classify3D --cluster --avgcluster --psfcluster --clusteriters 2 --classcut --maxProcesses 5 --realtime_inject --psfreduceonly --model_weights3D /dataz/dsa110/nsfrb/dsa110-nsfrb-training/final_commissioning_trainingset/model_weights_3Drev11_2025-09-26T03:51:36.076.pth --pthreshold 0.15  --toslack  --trigger #--pthreshold 0.5 --fnrtest #uncomment for fnr
		#/dataz/dsa110/nsfrb/dsa110-nsfrb-training/final_commissioning_trainingset/model_weights_3Drev11_2025-09-26T03:51:36.076.pth --pthreshold 0.5 --fnrtest # --testtrigger
		#taskset --cpu-list 21 python T4_manager.py --subimgpix 50 --gridsize 175 --SNRthresh 8 --useTOA --psfpercentile 70 --maxcands 1 --maxcand --classify3D --maxProcesses 5 --realtime_inject --model_weights3D /dataz/dsa110/nsfrb/dsa110-nsfrb-training/final_commissioning_trainingset/model_weights_3Drev11_2025-09-26T03:51:36.076.pth --pthreshold 0.15  --classcut --toslack
		#--model_weights3D /dataz/dsa110/nsfrb/dsa110-nsfrb-training/final_commissioning_trainingset/model_weights_3D_2025-09-06T03:08:41.072.pth #--model_weights2stage /dataz/dsa110/nsfrb/dsa110-nsfrb-training/final_commissioning_trainingset/model_weights_two_stage_2025-09-05T23:21:17.050.pth "$@" 
	else
		taskset --cpu-list 21 python T4_manager.py --subimgpix 50 --gridsize 175 --SNRthresh 6 --useTOA --psfpercentile 70 --maxcands 10 --classify3D --cluster --avgcluster --psfcluster --clusteriters 2 --classcut --maxProcesses 5 --toslack --psfreduceonly --model_weights3D /dataz/dsa110/nsfrb/dsa110-nsfrb-training/final_commissioning_trainingset/model_weights_3Drev11_2025-09-26T03:51:36.076.pth --pthreshold 0.15 
		#taskset --cpu-list 21 python T4_manager.py --subimgpix 175 --gridsize 175 --SNRthresh 3 --useTOA --psfpercentile 70 --maxcands 10 --classify3D --cluster --avgcluster --psfcluster --clusteriters 2 --maxcand --classcut --maxProcesses 5 --periods 10 20 30 40 --FFA --FFASNRthresh 0 --FFAbin 5 --FFAgulps 25 --FFAbinchans --toslack --remote --daskaddress "tcp://10.42.0.249:8786" # --daskaddress "tcp://10.42.0.228:8786" "$@" #--cluster --psfcluster --classify3D
	fi
fi
